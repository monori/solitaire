<!DOCTYPE html>
<html lang="da">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="Spil klassisk Klondike Kabale online eller offline. Gem dit fremskridt med bogmærker og følg dine statistikker. Ikke-påtrængende annoncer, mobil-venligt design.">
    <meta name="keywords" content="kabale, klondike, kortspil, online spil, offline spil, gratis spil, patience, kort, edderkop kabale, freecell, pyramide kabale, tripeaks, yukon, canfield, golf kabale, fyrre tyve, harmonika, ur kabale, huller, montana, skorpion, hveps, belejret slot, otte fra, bagers dusin, grusom, la belle lucie, vifte, kløver, tre toppe, pingvin, blomsterhave, bedstefars ur, bristol, beregning, fæstning, godt mål, lille edderkop, labyrint, frøken milligan, nestor, pingvin, pyramide, russisk kabale, sir tommy, spiderette, sultan, tyve fra egypten, kløverblad, tredobbelte toppe, westcliff, will o the wisp, zebra">
    <meta name="author" content="Gratis Online Kabale">
    <meta name="robots" content="index, follow">
    <meta name="language" content="da">
    
    <!-- PWA and Offline Support -->
    <link rel="manifest" href="/manifest-da.json">
    <meta name="theme-color" content="#2c8a43">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="default">
    <meta name="apple-mobile-web-app-title" content="Kabale">
    <meta name="mobile-web-app-capable" content="yes">
    
    <!-- Open Graph / Facebook -->
    <meta property="og:type" content="website">
    <meta property="og:url" content="https://gratis-7-kabale.dk/">
    <meta property="og:title" content="Gratis Online Kabale - Klassisk Klondike Kortspil">
    <meta property="og:description" content="Spil klassisk Klondike Kabale online eller offline. Gem dit fremskridt og følg dine statistikker!">
    <meta property="og:image" content="https://gratis-7-kabale.dk/solitaire-preview.jpg">
    <meta property="og:locale" content="da_DK">
    
    <!-- Alternate language versions -->
    <link rel="alternate" hreflang="en" href="https://free-solitaire-original.com/">
    <link rel="alternate" hreflang="da" href="https://gratis-7-kabale.dk/">
    <link rel="alternate" hreflang="x-default" href="https://free-solitaire-original.com/">
    
    <title>Gratis Online Kabale - Klassisk Klondike Kortspil</title>
    <link rel="stylesheet" href="../styles.css">
    
    <!-- Structured Data for SEO -->
    <script type="application/ld+json">
    {
        "@context": "https://schema.org",
        "@type": "Game",
        "name": "Gratis Online Kabale",
        "description": "Klassisk Klondike Kabale kortspil med gem-funktionalitet og statistik",
        "genre": "Kortspil",
        "gamePlatform": "Webbrowser",
        "operatingSystem": "Alle",
        "applicationCategory": "Spil",
        "offers": {
            "@type": "Offer",
            "price": "0",
            "priceCurrency": "DKK"
        },
        "aggregateRating": {
            "@type": "AggregateRating",
            "ratingValue": "4.8",
            "ratingCount": "1247"
        },
        "gameItem": {
            "@type": "Thing",
            "name": "Spillekort"
        },
        "numberOfPlayers": "1",
        "playMode": "SinglePlayer",
        "inLanguage": "da"
    }
    </script>
    
    <!-- Twitter Card -->
    <meta name="twitter:card" content="summary_large_image">
    <meta name="twitter:title" content="Gratis Online Kabale - Klassisk Klondike Kortspil">
    <meta name="twitter:description" content="Spil klassisk Klondike Kabale online eller offline. Gem dit fremskridt og følg dine statistikker!">
    <meta name="twitter:image" content="https://gratis-7-kabale.dk/solitaire-preview.jpg">
    
    <!-- Canonical URL -->
    <link rel="canonical" href="https://gratis-7-kabale.dk/">
    
    <!-- Preconnect for performance -->
    <link rel="preconnect" href="https://pagead2.googlesyndication.com">
    <link rel="preconnect" href="https://www.googletagmanager.com">
    
    <!-- Google AdSense Account -->
    <meta name="google-adsense-account" content="ca-pub-9436704170013305">
</head>
<body data-lang="da">
    <div class="game-container">
        <!-- Offline Mode Indicator -->
        <div class="offline-indicator">
            🔌 Spiller Offline - Fremskridt gemt lokalt
        </div>
        
        <header>
            <h1>Gratis Online Kabale</h1>
            <div class="game-controls">
                <button id="new-game-btn">Nyt Spil</button>
                <button id="undo-btn">Fortryd</button>
                <button id="bookmark-btn" class="bookmark-btn" title="Gem dit fremskridt ved at bogmærke denne side">
                    📌 Gem Fremskridt
                </button>
                <div class="draw-option">
                    <label for="draw-three-toggle">Træk Tre:</label>
                    <input type="checkbox" id="draw-three-toggle">
                </div>
            </div>
        </header>

        <div class="game-area">
            <div class="top-row">
                <div class="stock-waste">
                    <div id="stock" class="pile"></div>
                    <div id="waste" class="pile"></div>
                </div>
                <div class="foundations">
                    <div id="foundation-0" class="pile foundation"></div>
                    <div id="foundation-1" class="pile foundation"></div>
                    <div id="foundation-2" class="pile foundation"></div>
                    <div id="foundation-3" class="pile foundation"></div>
                </div>
            </div>

            <div class="tableau">
                <div id="tableau-0" class="pile tableau-pile"></div>
                <div id="tableau-1" class="pile tableau-pile"></div>
                <div id="tableau-2" class="pile tableau-pile"></div>
                <div id="tableau-3" class="pile tableau-pile"></div>
                <div id="tableau-4" class="pile tableau-pile"></div>
                <div id="tableau-5" class="pile tableau-pile"></div>
                <div id="tableau-6" class="pile tableau-pile"></div>
            </div>
        </div>

        <div class="stats-container">
            <div class="stats">
                <span>Spil: <span id="games-played">0</span></span>
                <span>Sejre: <span id="wins">0</span></span>
                <span>Nederlag: <span id="losses">0</span></span>
                <span>Hurtigste: <span id="fastest-time">--:--</span></span>
            </div>
        </div>

        <div class="toast-container" id="toast-container">
            <!-- Toast notifications will be added here dynamically -->
        </div>
    </div>

    <!-- Ad Section - Above SEO Content -->
    <div class="ad-section">
        <!-- Subtle bottom ad - only visible when scrolled down -->
        <div class="ad-container ad-subtle-bottom">
            <div class="ad-placeholder">📢 Annonceplads</div>
            <ins class="adsbygoogle"
                 style="display:block"
                 data-ad-client="ca-pub-9436704170013305"
                 data-ad-slot="2056797013"
                 data-ad-format="auto"
                 data-full-width-responsive="true"></ins>
        </div>

        <!-- Desktop side ads - only on very wide screens, minimal and blended -->
        <div class="ad-container ad-subtle-side ad-left">
            <div class="ad-placeholder">📢 Annonce</div>
            <ins class="adsbygoogle"
                 style="display:block"
                 data-ad-client="ca-pub-9436704170013305"
                 data-ad-slot="2304209025"
                 data-ad-format="vertical"></ins>
        </div>

        <div class="ad-container ad-subtle-side ad-right">
            <div class="ad-placeholder">📢 Annonce</div>
            <ins class="adsbygoogle"
                 style="display:block"
                 data-ad-client="ca-pub-9436704170013305"
                 data-ad-slot="7972318738"
                 data-ad-format="vertical"></ins>
        </div>
    </div>

    <!-- SEO Content Section - Danish -->
    <div class="seo-content">
        <div class="seo-section">
            <section class="game-description">
                <h2>Gratis Online Kabale - Klassisk Klondike Kortspil</h2>
                <p>Spil verdens mest populære kortspil gratis! Vores online Kabale (også kendt som Klondike Kabale eller Patience) tilbyder det klassiske gameplay du elsker med moderne funktioner som gem-funktionalitet, statistik og offline spil. Ingen downloads påkrævet - spil med det samme i din browser!</p>
            </section>

            <section class="how-to-play">
                <h2>Sådan Spiller Du Kabale</h2>
                <h3>Formål</h3>
                <p>Målet med Kabale er at flytte alle 52 kort til de fire grundbunker og bygge hver kulør fra Es til Konge (Es, 2, 3, 4, 5, 6, 7, 8, 9, 10, Knægt, Dame, Konge).</p>
                
                <h3>Spil Opsætning</h3>
                <ul>
                    <li><strong>Tableau:</strong> 7 kolonner med 1-7 kort hver, kun øverste kort vendt op</li>
                    <li><strong>Talon:</strong> Resterende kort i en bunke vendt ned</li>
                    <li><strong>Affald:</strong> Kort trukket fra talon bunken</li>
                    <li><strong>Grundbunker:</strong> 4 tomme bunker til at bygge kulører</li>
                </ul>

                <h3>Sådan Flytter Du Kort</h3>
                <ul>
                    <li>Træk og slip kort mellem bunker</li>
                    <li>Byg tableau kolonner i faldende rækkefølge, skiftende farver</li>
                    <li>Flyt kort til grundbunker i stigende rækkefølge efter kulør</li>
                    <li>Klik på talon bunken for at trække nye kort</li>
                    <li>Dobbeltklik på kort for automatisk at flytte til grundbunker</li>
                </ul>
            </section>

            <section class="game-features">
                <h2>Spil Funktioner</h2>
                <div class="features-grid">
                    <div class="feature">
                        <h3>🎮 Klassisk Gameplay</h3>
                        <p>Autentiske Klondike Kabale regler med glatte træk-og-slip kontroller</p>
                    </div>
                    <div class="feature">
                        <h3>💾 Gem Fremskridt</h3>
                        <p>Bogmærk dit spil for at fortsætte senere - ingen konto påkrævet</p>
                    </div>
                    <div class="feature">
                        <h3>📊 Statistikker</h3>
                        <p>Følg sejre, nederlag, spil spillet og hurtigste gennemførelsestider</p>
                    </div>
                    <div class="feature">
                        <h3>📱 Mobil Venlig</h3>
                        <p>Spil på enhver enhed - desktop, tablet eller smartphone</p>
                    </div>
                    <div class="feature">
                        <h3>🔌 Offline Spil</h3>
                        <p>Virker uden internetforbindelse når først indlæst</p>
                    </div>
                    <div class="feature">
                        <h3>⚡ Hurtig Indlæsning</h3>
                        <p>Ingen downloads, ingen registrering - begynd at spille med det samme</p>
                    </div>
                </div>
            </section>

            <!-- Cookie Banner -->
            <div id="cookie-banner" class="cookie-banner">
                <div class="cookie-content">
                    <div class="cookie-text">
                        <h3>🍪 Støt vores gratis spil med annoncer?</h3>
                        <p>Vi bruger ingen cookies som standard! Kun hvis du vælger at støtte os med ikke-påtrængende annoncer, sætter vi cookies til AdSense. Ellers kan du nyde spillet helt cookiefrit!</p>
                    </div>
                    <div class="cookie-buttons">
                        <button id="cookie-accept-all" class="cookie-btn cookie-accept">Støt Os - Vis Annoncer</button>
                        <button id="cookie-settings-btn" class="cookie-btn cookie-settings">Tilpas</button>
                        <button id="cookie-reject" class="cookie-btn cookie-reject">Spil Reklamefrit</button>
                    </div>
                </div>
            </div>

            <section class="faq">
                <h2>Ofte Stillede Spørgsmål</h2>
                <div class="faq-item">
                    <h3>Er dette Kabale spil gratis?</h3>
                    <p>Ja! Vores Kabale spil er helt gratis at spille. Ingen skjulte omkostninger, ingen premium funktioner - nyd ubegrænsede spil uden omkostninger.</p>
                </div>
                <div class="faq-item">
                    <h3>Skal jeg downloade noget?</h3>
                    <p>Ingen downloads påkrævet! Spil direkte i din webbrowser på enhver enhed. Spillet virker på Chrome, Firefox, Safari, Edge og alle moderne browsere.</p>
                </div>
                <div class="faq-item">
                    <h3>Kan jeg spille offline?</h3>
                    <p>Ja! Når spillet er indlæst, kan du spille offline. Dit fremskridt gemmes lokalt og synkroniseres når du er online igen.</p>
                </div>
                <div class="faq-item">
                    <h3>Hvordan gemmer jeg mit spil?</h3>
                    <p>Bare bogmærk siden (Ctrl+D eller Cmd+D) for at gemme din nuværende spiltilstand. Når du vender tilbage til bogmærket, fortsætter dit spil præcis hvor du slapped.</p>
                </div>
                <div class="faq-item">
                    <h3>Hvad er forskellen mellem Træk Et og Træk Tre?</h3>
                    <p>I Træk Et tilstand trækker du ét kort ad gangen fra talonen. Træk Tre tilstand trækker tre kort, hvilket gør spillet mere udfordrende.</p>
                </div>
                <div class="faq-item">
                    <h3>Kan jeg fortryde træk?</h3>
                    <p>Ja! Klik på "Fortryd" knappen for at omgøre dit sidste træk. Dette hjælper når du laver fejl eller vil prøve forskellige strategier.</p>
                </div>
            </section>

            <section class="solitaire-variants">
                <h2>Populære Kabale Varianter</h2>
                <p>Mens vores spil fokuserer på klassisk Klondike Kabale, er der mange andre populære varianter:</p>
                <ul>
                    <li><strong>Edderkop Kabale:</strong> Bruger to kortspil, byg sekvenser i samme kulør</li>
                    <li><strong>FreeCell:</strong> Alle kort synlige, bruger frie celler til midlertidig opbevaring</li>
                    <li><strong>Pyramide Kabale:</strong> Fjern par af kort der tilsammen giver 13</li>
                    <li><strong>TriPeaks:</strong> Ryd tre pyramidetoppe ved at vælge kort</li>
                    <li><strong>Yukon:</strong> Ligner Klondike men med forskellige uddelingsregler</li>
                </ul>
            </section>

            <section class="tips-strategies">
                <h2>Kabale Tips & Strategier</h2>
                <ul>
                    <li>Flyt altid Esser til grundbunker med det samme</li>
                    <li>Afdæk skjulte kort i tableau kolonner når muligt</li>
                    <li>Byg grundbunker jævnt for at holde muligheder åbne</li>
                    <li>Skynd dig ikke med at flytte kort til grundbunker - nogle gange er det bedre at beholde dem i tableau</li>
                    <li>Prøv at skabe tomme tableau kolonner til Konger</li>
                    <li>Planlæg flere træk frem før du laver dit træk</li>
                    <li>Brug fortryd funktionen til at eksperimentere med forskellige strategier</li>
                </ul>
            </section>

            <section class="ai-search-qa">
                <h2>Komplet Guide til Kabale</h2>
                
                <div class="qa-item">
                    <h3>Hvad er Kabale?</h3>
                    <p>Kabale er et enkeltperson kortspil spillet med et standard 52-korts spil. Den mest populære version er Klondike Kabale, hvor målet er at flytte alle kort til fire grundbunker og bygge hver kulør fra Es til Konge. Kabale har været et elsket spil i århundreder og tilbyder mental træning, afslapning og underholdning. Den digitale version blev berømt gennem Microsoft Windows og introducerede millioner til dette klassiske kortspil.</p>
                </div>

                <div class="qa-item">
                    <h3>Hvad er reglerne for Kabale?</h3>
                    <p>Kabale regler er ligetil: Start med 28 kort delt i 7 tableau kolonner (1-7 kort hver, kun øverste kort vendt op). De resterende 24 kort danner talon bunken. Byg grundbunker fra Es til Konge efter kulør. I tableau bygger du ned i skiftende farver (rød på sort, sort på rød). Du kan flytte vendte kort mellem tableau kolonner, vende skjulte kort når de afdækkes, og trække kort fra talonen. Kun Konger kan placeres i tomme tableau kolonner. Spillet vindes når alle kort er flyttet til grundbunkerne.</p>
                </div>

                <div class="qa-item">
                    <h3>Hvad er historien bag Kabale?</h3>
                    <p>Kabale opstod i Nordeuropa i slutningen af det 18. århundrede, muligvis i Skandinavien eller Tyskland. Spillet blev populært i Frankrig under Napoleon-æraen, hvor det blev kaldt "Patience." Klondike Kabale opstod specifikt under det canadiske Klondike Guldrush (1896-1899), deraf navnet. Spillet eksploderede i popularitet med Microsoft Windows i 1990, hvor det var inkluderet som et gratis spil for at hjælpe brugere med at lære musefærdigheder. I dag forbliver Kabale et af de mest spillede computerspil på verdensplan.</p>
                </div>

                <div class="qa-item">
                    <h3>Hvordan vinder man i Kabale?</h3>
                    <p>For at vinde i Kabale skal du flytte alle 52 kort til de fire grundbunker i stigende rækkefølge efter kulør (Es til Konge). Start med at lede efter Esser og lave kort til at bygge grundbunker. Afdæk altid skjulte tableau kort når muligt. Byg tableau sekvenser i faldende rækkefølge med skiftende farver. Skab tomme tableau kolonner til Konger. Skynd dig ikke med at flytte kort til grundbunker - nogle gange giver det flere strategiske muligheder at beholde dem i tableau. Brug fortryd funktionen til at udforske forskellige træk og lær af fejl.</p>
                </div>

                <div class="qa-item">
                    <h3>Hvad er Klondike Kabale?</h3>
                    <p>Klondike Kabale er den mest almindelige version af Kabale, ofte simpelthen kaldt "Kabale." Det bruger et standard 52-korts spil med specifikke regler: 28 kort delt i 7 tableau kolonner, 4 grundbunker for hver kulør, og en talon bunke. Spillere bygger grundbunker fra Es til Konge efter kulør, mens de bygger tableau kolonner i faldende rækkefølge med skiftende farver. Klondike kan spilles i "Træk Et" eller "Træk Tre" varianter, der refererer til hvor mange kort der trækkes fra talonen ad gangen.</p>
                </div>

                <div class="qa-item">
                    <h3>Er Kabale godt for hjernen?</h3>
                    <p>Ja, Kabale tilbyder flere kognitive fordele. Det forbedrer problemløsningsfærdigheder, mønstergenkendelse og strategisk tænkning. Spillet forbedrer hukommelsen ved at kræve at spillere husker kortplaceringer og planlægger sekvenser. Kabale giver stressreduktion og mental afslapning mens fokus opretholdes. Det er særligt gavnligt for ældre voksne som en form for mental træning der kan hjælpe med at opretholde kognitiv funktion. Spillet lærer også tålmodighed, planlægning og beslutningstagning i et lavt-pres miljø.</p>
                </div>

                <div class="qa-item">
                    <h3>Kan man altid vinde i Kabale?</h3>
                    <p>Ikke alle Kabale spil kan vindes. Studier foreslår at cirka 79-82% af Klondike Kabale spil teoretisk kan løses med perfekt spil. Dog er perfekt spil ekstremt svært for mennesker at opnå. De fleste spillere vinder omkring 10-15% af spillene, mens erfarne spillere måske vinder 20-30%. Mulighederne for at vinde afhænger af den indledende kortfordeling. Træk Tre spil er generelt sværere end Træk Et spil, med lavere sejrsrater på grund af den øgede sværhedsgrad ved at tilgå kort i talon bunken.</p>
                </div>

                <div class="qa-item">
                    <h3>Hvad er forskellen mellem Træk Et og Træk Tre Kabale?</h3>
                    <p>Træk Et og Træk Tre refererer til hvor mange kort du trækker fra talon bunken ad gangen. I Træk Et Kabale trækker og afslører du ét kort ad gangen fra talonen, hvilket gør alle talon kort til sidst tilgængelige. Træk Tre Kabale trækker tre kort ad gangen, men kun det øverste kort kan spilles, hvilket gør nogle kort potentielt utilgængelige. Træk Et er lettere og mere tilgivende, egnet til begyndere. Træk Tre er mere udfordrende og strategisk, foretrukket af erfarne spillere der søger større sværhedsgrad.</p>
                </div>

                <div class="qa-item">
                    <h3>Hvor lang tid tager et Kabale spil?</h3>
                    <p>Et typisk Kabale spil tager 5-15 minutter, afhængigt af spillerens erfaring og kompleksiteten af uddelingen. Hurtige spil kan afsluttes på 2-3 minutter, mens udfordrende uddelinger kan tage 20-30 minutter af omhyggelig overvejelse. Begyndere tager ofte længere tid da de lærer reglerne og strategierne. Spillets varighed afhænger også af om du spiller afslappet eller forsøger at optimere dine træk. Online versioner inkluderer ofte timere, hvor konkurrencedygtige spillere sigter mod hurtigere fuldførelsestider mens de opretholder høje sejrsrater.</p>
                </div>

                <div class="qa-item">
                    <h3>Hvad er de mest populære Kabale varianter?</h3>
                    <p>Udover Klondike inkluderer populære Kabale varianter: Edderkop Kabale (bruger to spil, bygger sekvenser i samme kulør), FreeCell (alle kort synlige, bruger frie celler til midlertidig opbevaring), Pyramide Kabale (fjern par der tilsammen giver 13), TriPeaks (ryd tre pyramidetoppe), Yukon (ligner Klondike med forskellig uddeling), Golf Kabale (ryd tableau ved at bygge op eller ned), og Canfield (hurtigere tempo med specifikke uddelingsregler). Hver variant tilbyder unikke udfordringer og strategier mens kernen af enkeltperson kortspil bevares.</p>
                </div>
            </section>
        </div>
    </div>

    <!-- Footer -->
    <footer class="site-footer">
        <div class="footer-content">
            <div class="footer-links">
                <a href="privatlivspolitik.html">Privatlivspolitik</a>
                <a href="servicevilkaar.html">Servicevilkår</a>
                <a href="https://forms.gle/tEP1JsYkncFTQxhF8" target="_blank" rel="noopener">Kontakt</a>
                <a href="#" id="cookie-settings">Cookie Indstillinger</a>
            </div>
            <div class="footer-text">
                <p>&copy; 2024 Gratis 7 Kabale. Alle rettigheder forbeholdes.</p>
            </div>
        </div>
    </footer>

    <!-- Cookie Settings Modal -->
    <div id="cookie-modal" class="cookie-modal">
        <div class="cookie-modal-content">
            <div class="cookie-modal-header">
                <h2>Cookie Indstillinger</h2>
                <button id="cookie-modal-close" class="cookie-close">&times;</button>
            </div>
            <div class="cookie-modal-body">
                <div class="cookie-category">
                    <div class="cookie-category-header">
                        <h3>Reklame Cookies</h3>
                        <label class="cookie-toggle">
                            <input type="checkbox" id="advertising-cookies">
                            <span class="toggle-slider"></span>
                        </label>
                    </div>
                    <p>Aktivér dette for at vise ikke-påtrængende annoncer der støtter vores gratis spil. Vi sætter kun cookies hvis du vælger annoncer - ellers kører spillet helt cookiefrit!</p>
                </div>
            </div>
            <div class="cookie-modal-footer">
                <button id="cookie-save-settings" class="cookie-btn cookie-accept">Gem Indstillinger</button>
            </div>
        </div>
    </div>

    <script src="../game.js"></script>
    
    <!-- Cookie Management Script -->
    <script>
        // Cookie consent management (Danish version)
        class CookieManager {
            constructor() {
                this.cookieSettings = this.loadSettings();
                this.init();
            }
            
            init() {
                // Show banner if no consent given yet
                if (!this.cookieSettings.consentGiven) {
                    this.showBanner();
                }
                
                // Initialize based on current settings
                this.applySettings();
                this.bindEvents();
            }
            
            loadSettings() {
                const stored = localStorage.getItem('cookieSettings');
                if (stored) {
                    return JSON.parse(stored);
                }
                return {
                    consentGiven: false,
                    advertising: false
                };
            }
            
            saveSettings() {
                localStorage.setItem('cookieSettings', JSON.stringify(this.cookieSettings));
            }
            
            showBanner() {
                const banner = document.getElementById('cookie-banner');
                banner.classList.add('show');
            }
            
            hideBanner() {
                const banner = document.getElementById('cookie-banner');
                banner.classList.remove('show');
            }
            
            showModal() {
                const modal = document.getElementById('cookie-modal');
                modal.classList.add('show');
                
                // Update toggle states
                document.getElementById('advertising-cookies').checked = this.cookieSettings.advertising;
            }
            
            hideModal() {
                const modal = document.getElementById('cookie-modal');
                modal.classList.remove('show');
            }
            
            acceptAll() {
                this.cookieSettings = {
                    consentGiven: true,
                    advertising: true
                };
                this.saveSettings();
                this.applySettings();
                this.hideBanner();
            }
            
            rejectNonEssential() {
                this.cookieSettings = {
                    consentGiven: true,
                    advertising: false
                };
                this.saveSettings();
                this.applySettings();
                this.hideBanner();
            }
            
            saveCustomSettings() {
                this.cookieSettings = {
                    consentGiven: true,
                    advertising: document.getElementById('advertising-cookies').checked
                };
                this.saveSettings();
                this.applySettings();
                this.hideModal();
                this.hideBanner();
            }
            
            applySettings() {
                // Load AdSense only if advertising cookies are accepted
                if (this.cookieSettings.advertising && navigator.onLine) {
                    this.loadAdSense();
                } else {
                    this.hideAds();
                }
            }
            
            loadAdSense() {
                // Only load if not already loaded
                if (!window.adsbygoogle) {
                    // Ensure ad containers are visible and have dimensions first
                    const adContainers = document.querySelectorAll('.ad-container');
                    let hasValidContainer = false;
                    
                    adContainers.forEach(container => {
                        if (container.offsetWidth > 0) {
                            hasValidContainer = true;
                        }
                    });
                    
                    // If no valid containers, wait and retry
                    if (!hasValidContainer) {
                        setTimeout(() => this.loadAdSense(), 500);
                        return;
                    }
                    
                    // Load AdSense script
                    const script = document.createElement('script');
                    script.async = true;
                    script.src = 'https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-9436704170013305';
                    script.crossOrigin = 'anonymous';
                    document.head.appendChild(script);
                    
                    script.onload = () => {
                        // Wait a moment for containers to be fully ready
                        setTimeout(() => {
                            try {
                                // Initialize ads with error handling
                                const adElements = document.querySelectorAll('.adsbygoogle');
                                adElements.forEach(ad => {
                                    if (ad.parentElement.offsetWidth > 0) {
                                        (window.adsbygoogle = window.adsbygoogle || []).push({});
                                    }
                                });
                                
                                // Show ad containers
                                document.querySelectorAll('.ad-container').forEach(ad => {
                                    ad.style.display = 'flex';
                                });
                            } catch (error) {
                                console.log('AdSense initialization delayed - retrying...');
                                // Retry after a longer delay if there's an error
                                setTimeout(() => {
                                    try {
                                        (window.adsbygoogle = window.adsbygoogle || []).push({});
                                        (window.adsbygoogle = window.adsbygoogle || []).push({});
                                        (window.adsbygoogle = window.adsbygoogle || []).push({});
                                    } catch (retryError) {
                                        console.log('AdSense failed to initialize after retry');
                                    }
                                }, 1000);
                            }
                        }, 100);
                    };
                    
                    script.onerror = () => {
                        console.log('AdSense script failed to load');
                    };
                }
            }
            
            hideAds() {
                // Hide all ad containers
                document.querySelectorAll('.ad-container').forEach(ad => {
                    ad.style.display = 'none';
                });
            }
            
            bindEvents() {
                // Banner buttons
                document.getElementById('cookie-accept-all').addEventListener('click', () => this.acceptAll());
                document.getElementById('cookie-reject').addEventListener('click', () => this.rejectNonEssential());
                document.getElementById('cookie-settings-btn').addEventListener('click', () => this.showModal());
                
                // Footer cookie settings link
                document.getElementById('cookie-settings').addEventListener('click', (e) => {
                    e.preventDefault();
                    this.showModal();
                });
                
                // Modal buttons
                document.getElementById('cookie-modal-close').addEventListener('click', () => this.hideModal());
                document.getElementById('cookie-save-settings').addEventListener('click', () => this.saveCustomSettings());
                
                // Close modal when clicking outside
                document.getElementById('cookie-modal').addEventListener('click', (e) => {
                    if (e.target.id === 'cookie-modal') {
                        this.hideModal();
                    }
                });
            }
        }
        
        // Initialize cookie manager when DOM is loaded
        document.addEventListener('DOMContentLoaded', () => {
            new CookieManager();
        });
    </script>
    
    <!-- Service Worker Registration for Offline Mode -->
    <script>
        // Register service worker for offline functionality
        if ('serviceWorker' in navigator) {
            window.addEventListener('load', () => {
                navigator.serviceWorker.register('/sw.js')
                    .then((registration) => {
                        console.log('Service Worker registered successfully:', registration.scope);
                        
                        // Check for updates
                        registration.addEventListener('updatefound', () => {
                            const newWorker = registration.installing;
                            newWorker.addEventListener('statechange', () => {
                                if (newWorker.state === 'installed' && navigator.serviceWorker.controller) {
                                    // New version available
                                    if (confirm('En ny version er tilgængelig! Genindlæs for at opdatere?')) {
                                        newWorker.postMessage({ type: 'SKIP_WAITING' });
                                        window.location.reload();
                                    }
                                }
                            });
                        });
                    })
                    .catch((error) => {
                        console.log('Service Worker registration failed:', error);
                    });
            });
        }
        
        // Online/Offline detection
        function updateOnlineStatus() {
            const isOnline = navigator.onLine;
            const body = document.body;
            
            if (isOnline) {
                body.classList.remove('offline');
                console.log('Online: Annoncer og eksterne funktioner tilgængelige');
            } else {
                body.classList.add('offline');
                console.log('Offline: Spillet fortsætter kun med lokal lagring');
            }
        }
        
        // Listen for online/offline events
        window.addEventListener('online', updateOnlineStatus);
        window.addEventListener('offline', updateOnlineStatus);
        
        // Check initial status
        updateOnlineStatus();
    </script>
</body>
</html> 